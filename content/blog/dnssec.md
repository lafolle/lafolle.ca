---
title: "Dnssec"
date: 2020-08-19T17:04:55-04:00
slug: "dnssec"
description: ""
keywords: []
draft: true
tags: []
math: false
toc: false
---


# Prelude

Is DNS secure without DNSSEC??? No.  All queries made by clients to recursive resolver, authoritative name servers, TLD name servers or root
name servers are un-encrypted.
Apart from that DNS is based on UDP protocol which is connectionless in nature such that if i have a DNS server running on my
(public) machine anyone who knows the IP and port on which the server is listening for traffic, can easily send request to it.

For example,  lets say rrdns sends a query to `ns1.google.com` to fetch A records for _google.com_ zone from a socket which
is binded to `localhost:30000`.  In case of happy path one of the machines corresponding to `ns1.google.com` wil reply back
with list of A records for _google.com_.  But an evil person can easily hijack the request and send back response
with IP address corresponding to evil-website because she would easily be able to read the queries as they fly around the 
internet un-encrypted.

In this case the onus is on the client to be able to verify if the response that it receives for a given query is valid or not.
How is that done? Welcome to DNSSEC.

## Digital Signatures

The basic problem that we intend to solve is- how to verify the origin of message ie, if Alice sends a message to Bob then how
can Bob be sure that the message he received is truely from Alice?  This is plain old problem in cryptography which is solved
using Digital Signatures which goes like this:
1. Alice generates a pair of keys: `public_key_alice` and `private_key_alice`.
2. Alice gives the `public_key_alice` to Bob.
3. Alice signs the message `M` using `private_key_alice`.
4. Alice sends the generated signature in 3 along with the actual message `M` to Bob.
5. Bob receives the message and verifies the signature using `public_key_alice`.

Question: when Bob receives the `public_key_alice` how can he be sure that the public key actually belongs to Alice?

How to do it using openssl?
```
Step:1
openssl genrsa # Generate key-pair for Alice. 
	-aes256 \
	-out private_key_alice.pem \
	4096 
openssl rsa \ # Generate (extract) public key from key-pair.
	-in private_key_alice.pwm \
	-pubout \
	-out public_key_alice.pem 

Step:3
openssl dgst \ # Sign data inside _file_ by private key
	-sha256 \
	-verify private_key_alice \
	-keyform PEM \
	-signature signature \
	-binary \
	file_containing_data 

Step:5
openssl dgst \ # Verify the signature.
	-sha256 \
	-verify public_key_alice.pem \
	-keyform PEM \
	-signature signature \
	-binary \
	file_containing_data

```

So Bob can verify the message given public key of Alice, signature generated by signing data with private key and the actual data.

If malicious Eve comes in between and changes data the verification at Bob's end would fail.  Would it be possible for Eve to change both
data and signature? Yes,  but then she would need to know Alice's private key to be able to generate signature which can be assertively
checked by Bob.  The private key really needs to be well protected or the whole system would break if it gets compromised.  And if it
ever does then a new key-pair needs to be generated immidiately.

## Digital Signatures in DNS

In DNS, each zone maintains its own RSA key-pair and signs the RRSet (set of resource records for given type and owner) of domains
it hosts with its private key.  When client makes a query to the DNS server, the server returns the answers (RRSets) and also their
corresponding signatures.  The client uses zone's public key which it acquired before hand to verify the RRSets and the signature
in response.

The zone's key-pair is known as zone-signing key-pair,  denoted by ZSK.  The signature of the RRSet is stored in resource record
whose type is RRSIG while the ZSK's public is published by zone in DNSKEY record.  Which means when the client gets the response
it can use DNSKEY record to get the public key of ZSK, RRSIG to get the digital signature of records set and present record sets 
to validate the authenticity of answers.


# Reference
1. https://danielpocock.com/rsa-key-sizes-2048-or-4096-bits/
2. Verifying authenticity of public key https://medium.com/storm4/how-do-i-know-its-really-you-verifying-authenticity-of-public-keys-1cba1ca36db6
3. DNSSEC Complexities and Considerations https://www.cloudflare.com/dns/dnssec/dnssec-complexities-and-considerations/
4. How dnssec works - https://www.cloudflare.com/dns/dnssec/how-dnssec-works/


































